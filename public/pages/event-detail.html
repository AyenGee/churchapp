<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Details - Sunday School Records</title>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body style="background: linear-gradient(to bottom, #f8fafc 0%, #f1f5f9 100%); min-height: 100vh;">
    <!-- Navigation -->
    <nav class="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center h-16">
                <a href="events.html" class="mr-4 hover:opacity-80 transition">â† Back</a>
                <h1 class="text-xl font-bold flex items-center gap-2 text-white">
                    <span>ğŸ‰</span> Event Details
                </h1>
            </div>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div id="eventDetails" class="space-y-6">
            <div class="flex justify-center items-center py-12">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            </div>
        </div>
    </main>

    <script src="../js/api.js"></script>
    <script src="../js/utils.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('id');

        async function loadEventDetails() {
            if (!eventId) {
                document.getElementById('eventDetails').innerHTML = '<p class="text-red-500">Event ID not provided</p>';
                return;
            }

            try {
                const event = await eventsAPI.getById(eventId);
                const startDate = new Date(event.startDate);
                const endDate = event.endDate ? new Date(event.endDate) : null;

                document.getElementById('eventDetails').innerHTML = `
                    <div class="card shadow-xl p-8">
                        <div class="border-b border-gray-200 pb-6 mb-6">
                            <h2 class="text-3xl font-bold mb-4 text-gray-900">${event.eventName}</h2>
                            <div class="flex flex-wrap gap-3">
                                <span class="badge badge-primary px-3 py-1">${event.eventType}</span>
                                ${event.isCompleted ? '<span class="badge badge-success px-3 py-1">Completed</span>' : '<span class="badge badge-warning px-3 py-1">Upcoming</span>'}
                            </div>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <h3 class="font-semibold text-gray-700 mb-1">ğŸ“… Date</h3>
                                <p>${formatDate(event.startDate)}${endDate ? ` - ${formatDate(event.endDate)}` : ''}</p>
                            </div>

                            ${event.location ? `
                                <div>
                                    <h3 class="font-semibold text-gray-700 mb-1">ğŸ“ Location</h3>
                                    <p>${event.location}</p>
                                </div>
                            ` : ''}

                            ${event.teachers && event.teachers.length > 0 ? `
                                <div>
                                    <h3 class="font-semibold text-gray-700 mb-2">ğŸ‘©â€ğŸ« Teachers/Leaders</h3>
                                    <div class="flex flex-wrap gap-2">
                                        ${event.teachers.map(teacher => `
                                            <span class="px-3 py-1 bg-gray-100 rounded text-sm">${teacher.name} (${teacher.role})</span>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}

                            <div>
                                <h3 class="font-semibold text-gray-700 mb-2">ğŸ‘¥ Attendance (${event.attendance?.length || 0} ${event.attendance?.length === 1 ? 'person' : 'people'})</h3>
                                ${event.attendance && event.attendance.length > 0 ? `
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                        ${event.attendance.map(child => `
                                            <div class="p-2 bg-gray-50 rounded">
                                                <div class="font-medium">${child.name}</div>
                                                <div class="text-sm text-gray-600">${child.class}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : '<p class="text-gray-500">No attendance recorded yet</p>'}
                            </div>

                            ${event.notes ? `
                                <div>
                                    <h3 class="font-semibold text-gray-700 mb-1">ğŸ“ Notes</h3>
                                    <p class="text-gray-700 whitespace-pre-wrap">${event.notes}</p>
                                </div>
                            ` : ''}

                            ${event.outcomes ? `
                                <div>
                                    <h3 class="font-semibold text-gray-700 mb-1">âœ… Outcomes</h3>
                                    <p class="text-gray-700 whitespace-pre-wrap">${event.outcomes}</p>
                                </div>
                            ` : ''}
                        </div>

                        <div class="mt-8 pt-6 border-t border-gray-200 flex gap-4">
                            <button onclick="editEvent()" 
                                class="btn btn-primary flex-1 px-6 py-3 text-base font-medium shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                Edit Event
                            </button>
                            <button onclick="deleteEvent()" 
                                class="btn btn-danger flex-1 px-6 py-3 text-base font-medium shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                Delete Event
                            </button>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading event:', error);
                document.getElementById('eventDetails').innerHTML = '<p class="text-red-500">Error loading event details</p>';
            }
        }

        function editEvent() {
            window.location.href = `add-event.html?id=${eventId}`;
        }

        async function deleteEvent() {
            if (!confirm('Are you sure you want to delete this event?')) return;

            try {
                await eventsAPI.delete(eventId);
                showNotification('Event deleted successfully', 'success');
                setTimeout(() => {
                    window.location.href = 'events.html';
                }, 1500);
            } catch (error) {
                showNotification('Failed to delete event', 'error');
            }
        }

        // Load event details on page load
        loadEventDetails();
    </script>
</body>
</html>

